
<html><head><base href="https://websim.cyou/fourth-cycle-era-tracker/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Четвертый Цикл - Эра Tracker</title>
<style>
  body {
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background-color: #000;
    font-family: Arial, sans-serif;
    color: #fff;
    overflow: hidden;
  }
  
  .stars {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }
  
  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 90%;
    max-width: 1200px;
    padding: 40px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(5px);
  }
  
  .last-entry {
    font-size: 1.5vw;
    margin-bottom: 20px;
    text-align: center;
    width: 100%;
  }
  
  .main-content {
    display: flex;
    justify-content: space-between;
    width: 100%;
  }
  
  .era-info {
    flex: 1;
    text-align: center;
  }
  
  .era-number {
    font-size: 12vw;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
    animation: pulse 2s infinite alternate;
  }
  
  .era-text {
    font-size: 4vw;
    margin-top: 20px;
    color: #fff;
  }
  
  .cycle-text {
    font-size: 3vw;
    margin-top: 10px;
    color: #ccc;
  }
  
  .countdown {
    font-size: 1.5vw;
    margin-top: 30px;
    color: #ccc;
  }
  
  .sunrise-times {
    font-size: 1.2vw;
    margin-top: 20px;
    color: #ccc;
  }
  
  #sunrise {
    width: 100%;
    height: 100px;
    position: relative;
    overflow: hidden;
    margin-top: 30px;
  }
  
  #sun {
    width: 60px;
    height: 60px;
    background: #ffdb58;
    border-radius: 50%;
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    box-shadow: 0 0 20px #ffdb58;
    transition: bottom 1s ease-in-out;
  }
  
  .checkboxes {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-left: 40px;
  }
  
  .checkbox-column {
    display: flex;
    flex-direction: column;
  }
  
  .column-title {
    font-size: 1.5vw;
    font-weight: bold;
    margin-bottom: 10px;
    text-align: center;
  }
  
  .checkbox-item {
    display: flex;
    align-items: center;
    font-size: 1.2vw;
    margin-bottom: 5px;
  }
  
  .checkbox-item input[type="checkbox"] {
    margin-right: 10px;
    width: 20px;
    height: 20px;
  }
  
  .aeon-infinities {
    grid-column: 1 / -1;
    margin-top: 20px;
    font-size: 1.5vw;
    text-align: center;
  }
  
  .confirm-button {
    grid-column: 1 / -1;
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 1.2vw;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  
  .confirm-button:hover {
    background-color: #45a049;
  }
  
  .confirm-button:disabled {
    background-color: #cccccc;
    cursor: not-allowed;
  }
  
  .history-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 10px 20px;
    font-size: 1.2vw;
    background-color: #008CBA;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  
  .history-button:hover {
    background-color: #007B9A;
  }
  
  .history-panel {
    display: none;
    position: fixed;
    bottom: 70px;
    right: 20px;
    width: 300px;
    max-height: 400px;
    overflow-y: auto;
    background-color: rgba(0, 0, 0, 0.8);
    border-radius: 5px;
    padding: 20px;
  }
  
  .history-item {
    margin-bottom: 10px;
    font-size: 1vw;
    color: #fff;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); }
    100% { transform: scale(1.05); }
  }

  @keyframes twinkle {
    0% { opacity: 0.5; }
    100% { opacity: 1; }
  }
</style>
</head>
<body>
<div class="stars"></div>
<div class="container">
  <div class="last-entry" id="lastEntry"></div>
  <div class="main-content">
    <div class="era-info">
      <div class="era-number" id="eraNumber"></div>
      <div class="era-text">Эра</div>
      <div class="cycle-text" id="cycleText">Четвертый цикл</div>
      <div class="countdown" id="countdown"></div>
      <div class="sunrise-times" id="sunriseTimes"></div>
      <div id="sunrise">
        <div id="sun"></div>
      </div>
    </div>
    <div class="checkboxes">
      <div class="checkbox-column">
        <div class="column-title">Ма</div>
        <div class="checkbox-item">
          <input type="checkbox" id="potential"> <label for="potential">Потенциал</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="balance"> <label for="balance">Баланс</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="inspiration"> <label for="inspiration">Вдохновение</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="fantasy"> <label for="fantasy">Фантазия</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="space"> <label for="space">Пространство</label>
        </div>
      </div>
      <div class="checkbox-column">
        <div class="column-title">Жи</div>
        <div class="checkbox-item">
          <input type="checkbox" id="realization"> <label for="realization">Реализация</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="creation"> <label for="creation">Созидание</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="energy"> <label for="energy">Энергия</label>
        </div>
      </div>
      <div class="checkbox-column">
        <div class="column-title">Кун</div>
        <div class="checkbox-item">
          <input type="checkbox" id="unity"> <label for="unity">Единство</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="creativity"> <label for="creativity">Творчество</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="life"> <label for="life">Жизнь</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="joy"> <label for="joy">Радость</label>
        </div>
      </div>
      <div class="aeon-infinities" id="aeonInfinities">Эон бесконечностей: </div>
      <button class="confirm-button" id="confirmButton" disabled>Подтвердить выбор</button>
    </div>
  </div>
</div>

<button class="history-button" id="historyButton">История</button>
<div class="history-panel" id="historyPanel"></div>

<script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js"></script>
<script>
const DateTime = luxon.DateTime;
let currentCycle = 4;
let history = [];
let isSelectionConfirmed = false;
let nextEraTime;

function createStars() {
  const starsContainer = document.querySelector('.stars');
  const starCount = 200;

  for (let i = 0; i < starCount; i++) {
    const star = document.createElement('div');
    star.style.position = 'absolute';
    star.style.left = `${Math.random() * 100}%`;
    star.style.top = `${Math.random() * 100}%`;
    star.style.width = `${Math.random() * 2 + 1}px`;
    star.style.height = star.style.width;
    star.style.backgroundColor = '#fff';
    star.style.borderRadius = '50%';
    star.style.opacity = Math.random() * 0.5 + 0.5;
    star.style.animation = `twinkle ${Math.random() * 4 + 2}s infinite alternate`;
    starsContainer.appendChild(star);
  }
}

function getSunriseTimes() {
  const now = DateTime.now().setZone("Europe/Minsk");
  const lat = 53.9; // Широта Минска
  const lon = 27.5667; // Долгота Минска

  const todaySunrise = DateTime.fromJSDate(SunCalc.getTimes(now.toJSDate(), lat, lon).sunrise).setZone("Europe/Minsk");
  const tomorrowSunrise = DateTime.fromJSDate(SunCalc.getTimes(now.plus({ days: 1 }).toJSDate(), lat, lon).sunrise).setZone("Europe/Minsk");

  return { todaySunrise, tomorrowSunrise };
}

function getCurrentEra() {
  const { todaySunrise } = getSunriseTimes();
  const now = DateTime.now().setZone("Europe/Minsk");
  const daysSince = Math.floor(now.diff(todaySunrise.set({ year: 2024, month: 4, day: 26 }), 'days').days);
  return daysSince + 19 - 7; // Вычитаем 7 эр согласно предыдущему условию
}

function updateEraAndCountdown() {
  const now = DateTime.now().setZone("Europe/Minsk");
  const { todaySunrise, tomorrowSunrise } = getSunriseTimes();
  const currentEra = getCurrentEra();

  document.getElementById('eraNumber').textContent = currentEra;
  document.getElementById('cycleText').textContent = `${currentCycle}-й цикл`;

  let countdownText;
  let nextSunrise;

  if (now < todaySunrise) {
    countdownText = "До начала новой эры:";
    nextSunrise = todaySunrise;
  } else {
    countdownText = "До следующей эры:";
    nextSunrise = tomorrowSunrise;
  }

  nextEraTime = nextSunrise;

  const timeUntilNextEra = nextSunrise.diff(now, ['hours', 'minutes', 'seconds']);
  document.getElementById('countdown').textContent = `${countdownText} ${timeUntilNextEra.hours} часов, ${timeUntilNextEra.minutes} минут, ${Math.floor(timeUntilNextEra.seconds)} секунд`;

  // Обновляем времена восхода солнца
  document.getElementById('sunriseTimes').textContent = `Восход сегодня: ${todaySunrise.toFormat('HH:mm')} | Восход завтра: ${tomorrowSunrise.toFormat('HH:mm')}`;

  // Анимация восхода солнца
  const dayProgress = (now.hour * 3600 + now.minute * 60 + now.second) / 86400;
  const sunPosition = Math.max(0, Math.min(dayProgress * 200 - 30, 70));
  document.getElementById('sun').style.bottom = `${sunPosition}px`;

  // Проверяем, наступила ли новая эра
  if (now >= nextSunrise) {
    isSelectionConfirmed = false;
    enableConfirmButton();
  }

  updateConfirmButtonState();
}

function updateAeonInfinities() {
  const checkedBoxes = document.querySelectorAll('.checkboxes input[type="checkbox"]:checked');
  const checkedNames = Array.from(checkedBoxes).map(box => box.nextElementSibling.textContent);
  document.getElementById('aeonInfinities').textContent = `Эон бесконечностей: ${checkedNames.join(', ')}`;
}

function setupCheckboxes() {
  const checkboxes = document.querySelectorAll('.checkboxes input[type="checkbox"]');
  checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', () => {
      updateAeonInfinities();
      checkCycleCompletion();
      updateConfirmButtonState();
    });
  });
}

function checkCycleCompletion() {
  const columns = [
    ['potential', 'balance', 'inspiration', 'fantasy', 'space'],
    ['realization', 'creation', 'energy'],
    ['unity', 'creativity', 'life', 'joy']
  ];

  const columnCounts = columns.map(column => 
    column.filter(id => document.getElementById(id).checked).length
  );

  if (columnCounts.every(count => count === columnCounts[0] && count > 0)) {
    currentCycle++;
    document.getElementById('cycleText').textContent = `${currentCycle}-й цикл`;
    // Сбрасываем все галочки
    const checkboxes = document.querySelectorAll('.checkboxes input[type="checkbox"]');
    checkboxes.forEach(checkbox => checkbox.checked = false);
    updateAeonInfinities();
    
    // Сохраняем новый цикл в локальное хранилище
    localStorage.setItem('currentCycle', currentCycle);
    
    // Отправляем данные о новом цикле на сервер (имитация)
    console.log('Отправка данных о новом цикле на сервер:', currentCycle);
  }
}

function confirmSelection() {
  if (isSelectionConfirmed) return;
  
  const checkedBoxes = document.querySelectorAll('.checkboxes input[type="checkbox"]:checked');
  const checkedNames = Array.from(checkedBoxes).map(box => box.nextElementSibling.textContent);
  const currentEra = getCurrentEra();
  const historyEntry = `Эра ${currentEra}. Цикл ${currentCycle}. Эон ${checkedNames.join(', ')}`;
  
  // Проверяем, нет ли уже такой записи в истории
  if (!history.includes(historyEntry)) {
    history.push(historyEntry);
    updateHistoryPanel();
    updateLastEntry();
    
    // Сохраняем историю в локальное хранилище
    localStorage.setItem('eraHistory', JSON.stringify(history));
    
    // Отправляем данные на сервер (имитация)
    console.log('Отправка данных на сервер:', historyEntry);
  }
  
  isSelectionConfirmed = true;
  disableConfirmButton();
}

function updateHistoryPanel() {
  const historyPanel = document.getElementById('historyPanel');
  historyPanel.innerHTML = '';
  history.forEach(entry => {
    const historyItem = document.createElement('div');
    historyItem.className = 'history-item';
    historyItem.textContent = entry;
    historyPanel.appendChild(historyItem);
  });
}

function updateLastEntry() {
  const lastEntryElement = document.getElementById('lastEntry');
  if (history.length > 0) {
    lastEntryElement.textContent = history[history.length - 1];
  } else {
    lastEntryElement.textContent = '';
  }
}

function toggleHistoryPanel() {
  const historyPanel = document.getElementById('historyPanel');
  historyPanel.style.display = historyPanel.style.display === 'none' ? 'block' : 'none';
}

function disableConfirmButton() {
  document.getElementById('confirmButton').disabled = true;
}

function enableConfirmButton() {
  document.getElementById('confirmButton').disabled = false;
}

function updateConfirmButtonState() {
  const now = DateTime.now().setZone("Europe/Minsk");
  const checkedBoxes = document.querySelectorAll('.checkboxes input[type="checkbox"]:checked');
  const isAnyChecked = checkedBoxes.length > 0;
  const isNewEra = now >= nextEraTime;

  document.getElementById('confirmButton').disabled = isSelectionConfirmed || !isAnyChecked || !isNewEra;
}

function loadSavedData() {
  const savedCycle = localStorage.getItem('currentCycle');
  if (savedCycle) {
    currentCycle = parseInt(savedCycle);
    document.getElementById('cycleText').textContent = `${currentCycle}-й цикл`;
  }
  
  const savedHistory = localStorage.getItem('eraHistory');
  if (savedHistory) {
    history = JSON.parse(savedHistory);
    updateHistoryPanel();
    updateLastEntry();
  }
}

createStars();
loadSavedData();
updateEraAndCountdown();
setupCheckboxes();
setInterval(updateEraAndCountdown, 1000);

document.getElementById('confirmButton').addEventListener('click', confirmSelection);
document.getElementById('historyButton').addEventListener('click', toggleHistoryPanel);

// Имитация получения данных с сервера
function fetchDataFromServer() {
  // В реальном приложении здесь был бы запрос к серверу
  console.log('Получение данных с сервера...');
  // Обновление данных на основе полученной информации
  // updateDataFromServer(receivedData);
}

// Запускаем периодическую проверку обновлений с сервера
setInterval(fetchDataFromServer, 60000); // каждую минуту
</script>
</body></html>
